streaming_platforms_dlt_pipeline:
  description: "Load streaming platform datasets using dlt with pure ORM approach"
  schedule: "@daily"
  start_date: 2025-01-01
  catchup: false
  max_active_runs: 1
  tags:
    - dlt
    - streaming
    - etl
    - duckdb
    - orm
    - sqlalchemy

  default_args:
    owner: "data-team"
    depends_on_past: false
    email_on_failure: false
    email_on_retry: false
    retries: 1
    retry_delay_minutes: 5

  tasks:
    load_netflix_data:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: load_csv_to_orm_direct
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      op_kwargs:
        platform_name: "netflix"
        csv_filename: "netflix_titles.csv"
        datasets_path: "/opt/airflow/datasets"

    load_disney_data:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: load_csv_to_orm_direct
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      op_kwargs:
        platform_name: "disney"
        csv_filename: "disney_plus_titles.csv"
        datasets_path: "/opt/airflow/datasets"

    load_hulu_data:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: load_csv_to_orm_direct
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      op_kwargs:
        platform_name: "hulu"
        csv_filename: "hulu_titles.csv"
        datasets_path: "/opt/airflow/datasets"

    load_prime_data:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: load_csv_to_orm_direct
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      op_kwargs:
        platform_name: "prime"
        csv_filename: "amazon_prime_titles.csv"
        datasets_path: "/opt/airflow/datasets"

    merge_duplicate_titles:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: merge_titles_using_orm
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      dependencies:
        - load_netflix_data
        - load_disney_data
        - load_hulu_data
        - load_prime_data

    validate_data:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: validate_data_pure_orm
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      dependencies:
        - merge_duplicate_titles

    analyze_cross_platform_rankings:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: analyze_with_pure_orm
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      dependencies:
        - merge_duplicate_titles

    demonstrate_orm_capabilities:
      operator: airflow.operators.python.PythonOperator
      python_callable_name: demonstrate_orm_power
      python_callable_file: /opt/airflow/dags/streaming_platforms_dlt/functions.py
      dependencies:
        - validate_data
        - analyze_cross_platform_rankings
